generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider          = "postgresql"
    url               = env("DATABASE_URL")
    directUrl         = env("DIRECT_URL")
}

enum EditorStatus {
    Beginner
    Editor
    Administrator
}

model User {
    id              String       @id @db.VarChar(255)
    name            String       @db.VarChar(255)
    email           String       @unique @db.VarChar(255)
    password        String       @db.VarChar(255)
    createdAt       DateTime     @default(now()) @map(name: "created_at")
    contents        Content[]
    likes           Content[]    @relation("likes")
    dislikes        Content[]    @relation("dislikes")
    
    following       User[]       @relation("following")
    followedBy      User[]       @relation("following")

    authenticated   Boolean      @default(false)
    editorStatus    EditorStatus @default(Beginner)

    subscriptionsUsed        Subscription[]
    subscriptionsBought      Subscription[]  @relation("bought")

    @@map(name: "users")
}


model Subscription {
    id                String      @id @default(cuid())
    user              User?       @relation(fields: [userId], references: [id])
    userId            String?
    createdAt         DateTime    @default(now()) @map(name: "created_at")

    boughtBy          User       @relation("bought", fields: [boughtByUserId], references: [id])
    boughtByUserId    String

    usedAt            DateTime?
}

enum ProtectionLevel {
    Unprotected
    Administrator
}

model Entity {
    id              String       @id
    name            String       @unique @db.VarChar(255)
    protection      ProtectionLevel @default(Unprotected)
    isPublic        Boolean      @default(false)
    versions        Content[]

    referencedBy    Content[]    @relation("entityReferences")
}


enum ContentType {
    Comment
    Post
    FastPost
    EntityContent
}

model Content {
    id                String      @id @default(cuid())
    text              String

    createdAt         DateTime    @default(now()) @map(name: "created_at")
    type              ContentType

    author            User       @relation(fields: [authorId], references: [id])
    authorId          String

    childrenContents  Content[]   @relation("ContentToContent")

    // parent for comments
    parentContents    Content[]   @relation("ContentToContent")

    likedBy           User[]      @relation("likes")
    dislikedBy        User[]      @relation("dislikes")

    parentEntity      Entity?     @relation(fields: [parentEntityId], references: [id])
    parentEntityId    String?

    // true or false for Post or FastPost, null for other types
    isDraft           Boolean?

    visible           Boolean     @default(true)

    // solo para publicaciones largas
    title             String?

    // solo para art√≠culos (entities)
    categories        String       @default("[]")

    entityReferences  Entity[]     @relation("entityReferences")  
}